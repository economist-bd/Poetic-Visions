<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poetic Visions | Share Your Creations</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">


    <style>
        /* Custom styles to enhance the look and feel */
        body {
            font-family: 'Hind Siliguri', 'Inter', sans-serif;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        .font-title {
            font-family: 'Playfair Display', serif;
        }
        
        .gradient-text {
            background: -webkit-linear-gradient(45deg, #ffffff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #poem-feed::-webkit-scrollbar { width: 8px; }
        #poem-feed::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        #poem-feed::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.4); border-radius: 10px; }
        #poem-feed::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.6); }

        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ffffff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1.5s linear infinite;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.4s ease;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
        }
        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        /* Keyframe animations */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="text-gray-800">

    <!-- Faint background scenery on the left -->
    <div class="fixed top-0 left-0 w-1/3 h-full pointer-events-none z-0 hidden lg:block">
        <svg width="100%" height="100%" viewBox="0 0 400 800" preserveAspectRatio="xMidYMid slice" style="opacity: 0.08;">
            <!-- SVG content for scenery -->
            <g transform="translate(120, 150) rotate(-45)"><circle cx="0" cy="0" r="40" fill="white"/><line x1="0" y1="-50" x2="0" y2="-70" stroke="white" stroke-width="4"/><line x1="0" y1="50" x2="0" y2="70" stroke="white" stroke-width="4"/><line x1="-50" y1="0" x2="-70" y2="0" stroke="white" stroke-width="4"/><line x1="50" y1="0" x2="70" y2="0" stroke="white" stroke-width="4"/><line x1="-35" y1="-35" x2="-50" y2="-50" stroke="white" stroke-width="4"/><line x1="35" y1="-35" x2="50" y2="-50" stroke="white" stroke-width="4"/><line x1="-35" y1="35" x2="-50" y2="50" stroke="white" stroke-width="4"/><line x1="35" y1="35" x2="50" y2="50" stroke="white" stroke-width="4"/></g><path d="M -50 800 Q 100 600, 200 400 T 250 150" stroke="white" stroke-width="25" fill="none"/><g transform="translate(280, 650)"><path d="M 0,0 v -150" stroke="white" stroke-width="12"/><path d="M 0,-100 c -40,-20 -70,-70 -40,-110" stroke="white" stroke-width="8" fill="none"/><path d="M 0,-80 c 40,-10 60,-50 30,-90" stroke="white" stroke-width="8" fill="none"/><path d="M 0,-50 c 20,10 30,-20 10,-50" stroke="white" stroke-width="7" fill="none"/></g>
        </svg>
    </div>

    <!-- Logo in the top right corner -->
    <div class="fixed top-4 right-4 md:top-6 md:right-6 z-50">
        <div class="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center shadow-lg backdrop-filter backdrop-blur-sm border border-white/30">
            <svg class="w-7 h-7 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto p-4 md:p-8 relative z-10">
        
        <!-- Header Section -->
        <header class="text-center mb-8 md:mb-12">
            <h1 class="font-title text-5xl md:text-7xl font-bold gradient-text" style="text-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);">Poetic Visions</h1>
            <p class="text-lg md:text-xl text-white/90 mt-2 font-medium">যেখানে শব্দ এবং ছবি শিল্প তৈরি করে।</p>
        </header>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <!-- Form Section -->
            <div class="lg:col-span-5 card p-6 md:p-8">
                <h2 class="font-title text-2xl md:text-3xl font-semibold mb-6 text-gray-900">আপনার অনুভূতি
                    শেয়ার করুন</h2>
                <form id="poem-form" class="space-y-6">
                    <!-- Author & Title -->
                    <div><label for="author-name" class="block text-sm font-medium text-gray-800 mb-1">আপনার নাম</label><input type="text" id="author-name" required class="w-full px-4 py-2 bg-white/50 border border-gray-300/50 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition duration-300"></div>
                    <div><label for="poem-title" class="block text-sm font-medium text-gray-800 mb-1">শিরোনাম</label><input type="text" id="poem-title" required class="w-full px-4 py-2 bg-white/50 border border-gray-300/50 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition duration-300"></div>
                    <div><label for="poem-content" class="block text-sm font-medium text-gray-800 mb-1">আপনার কবিতা</label><textarea id="poem-content" rows="6" required class="w-full px-4 py-2 bg-white/50 border border-gray-300/50 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition"></textarea></div>

                    <!-- Image Upload -->
                    <div>
                        <label for="image-file" class="block text-sm font-medium text-gray-800 mb-1">একটি ছবি দিন</label>
                        <input type="file" id="image-file" accept="image/*" required class="w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-white/60 file:text-pink-700 hover:file:bg-white/80 transition duration-300 cursor-pointer">
                    </div>

                    <!-- Image Preview -->
                    <div id="image-preview-container" class="w-full h-48 bg-gray-200/30 rounded-lg flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-400/50">
                         <img id="image-preview" src="" alt="Image Preview" class="hidden h-full w-full object-cover">
                         <span id="preview-text" class="text-gray-700">ছবির প্রিভিউ</span>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" id="submit-btn" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:from-pink-600 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500 transition-all duration-300 transform hover:scale-105 hover:shadow-xl flex items-center justify-center">
                        <span id="submit-text">প্রকাশ করুন</span>
                        <div id="submit-loader" class="loader hidden" style="width: 20px; height: 20px;"></div>
                    </button>
                </form>
                 <!-- User ID display -->
                <div class="mt-4 text-center"><p class="text-xs text-gray-700/80">আপনার ইউজার আইডি: <br><span id="user-id" class="font-mono"></span></p></div>
            </div>

            <!-- Poem Feed Section -->
            <div class="lg:col-span-7">
                <h2 class="font-title text-2xl md:text-3xl font-semibold mb-6 text-white/90" style="text-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);">কমিউনিটি গ্যালারি</h2>
                <div id="poem-feed" class="space-y-8 h-[80vh] overflow-y-auto pr-4">
                     <div id="feed-loader" class="flex justify-center items-center h-full"><div class="loader" style="border-top-color: #ffffff;"></div></div>
                </div>
            </div>
        </div>

        <!-- Footer Section -->
        <footer class="text-center mt-12 py-6 border-t border-white/20">
            <p class="text-white/90 text-lg font-medium">মোঃ মঞ্জুরুল হক</p>
            <p class="text-white/70 text-sm">প্রভাষক-অর্থনীতি, জিয়াউদ্দিন স্কুল এন্ড কলেজ</p>
        </footer>
    </div>

    <!-- Firebase and App Logic -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

        // --- Firebase Configuration ---
        // User-provided Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDWk-dK56ZDmIre3ny8v0n7109AiqfjWW0",
          authDomain: "poetic-visions-4ac1d.firebaseapp.com",
          projectId: "poetic-visions-4ac1d",
          storageBucket: "poetic-visions-4ac1d.firebasestorage.app",
          messagingSenderId: "970780215745",
          appId: "1:970780215745:web:ec8383c4e1aabc1120c740",
          measurementId: "G-DGFKKP7GGB"
        };
        
        // User-provided Realtime Database URL (for reference)
        // https://poetic-visions-4ac1d-default-rtdb.firebaseio.com/

        let db, auth, analytics, userId;

        // --- DOM Element References ---
        const poemForm = document.getElementById('poem-form');
        const authorNameInput = document.getElementById('author-name');
        const poemTitleInput = document.getElementById('poem-title');
        const poemContentInput = document.getElementById('poem-content');
        const imageFileInput = document.getElementById('image-file');
        const imagePreview = document.getElementById('image-preview');
        const previewText = document.getElementById('preview-text');
        const poemFeed = document.getElementById('poem-feed');
        const feedLoader = document.getElementById('feed-loader');
        const submitBtn = document.getElementById('submit-btn');
        const submitText = document.getElementById('submit-text');
        const submitLoader = document.getElementById('submit-loader');
        const userIdDisplay = document.getElementById('user-id');

        // --- Main Application Logic ---
        async function main() {
            try {
                // Initialize Firebase
                const app = initializeApp(firebaseConfig);
                analytics = getAnalytics(app);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        userIdDisplay.textContent = userId;
                        listenForPoems();
                    } else {
                        try {
                            await signInAnonymously(auth);
                        } catch (error) {
                            console.error("Authentication failed:", error);
                            userIdDisplay.textContent = "Authentication failed.";
                        }
                    }
                });
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                poemFeed.innerHTML = `<p class="text-red-500 text-center">Error: Could not connect to services.</p>`;
                feedLoader.classList.add('hidden');
            }
        }

        // --- Event Listeners ---
        imageFileInput.addEventListener('change', () => {
            const file = imageFileInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                imagePreview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
            previewText.classList.add('hidden');
        });

        poemForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!userId) {
                alert("আপনাকে অবশ্যই পোস্ট করার জন্য প্রমাণীকৃত হতে হবে।");
                return;
            }

            setLoading(true);

            const author = authorNameInput.value.trim();
            const title = poemTitleInput.value.trim();
            const poem = poemContentInput.value.trim();
            const imageFile = imageFileInput.files[0];

            if (author && title && poem && imageFile) {
                try {
                    const imageUrl = await toBase64(imageFile);
                    const poemData = { author, title, poem, imageUrl, createdAt: new Date(), userId };
                    
                    const poemsCollection = collection(db, `poems`);
                    await addDoc(poemsCollection, poemData);

                    poemForm.reset();
                    imagePreview.classList.add('hidden');
                    imagePreview.src = '';
                    previewText.classList.remove('hidden');

                } catch (error) {
                    console.error("Error adding document: ", error);
                    alert(`Submission Failed!\nError: ${error.message}`);
                } finally {
                    setLoading(false);
                }
            } else {
                alert("দয়া করে সব ক্ষেত্র পূরণ করুন এবং একটি ছবি নির্বাচন করুন।");
                setLoading(false);
            }
        });

        // Event listener for Facebook share buttons
        poemFeed.addEventListener('click', function(event) {
            const shareButton = event.target.closest('.share-btn');
            if (shareButton) {
                event.preventDefault();
                const { title, author, poem } = shareButton.dataset;
                
                const urlToShare = 'https://economist-bd.github.io/Poetic-Visions/';
                const quoteText = `কবিতা: ${title}\nকবি: ${author}\n\n${poem}`;
                
                const facebookShareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(urlToShare)}&quote=${encodeURIComponent(quoteText)}`;
                
                window.open(facebookShareUrl, 'Share on Facebook', 'width=600,height=400');
            }
        });

        // --- Helper Functions ---
        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        function setLoading(isLoading) {
            submitText.classList.toggle('hidden', isLoading);
            submitLoader.classList.toggle('hidden', !isLoading);
            submitBtn.disabled = isLoading;
        }

        function listenForPoems() {
            const poemsCollection = collection(db, `poems`);
            const q = query(poemsCollection); 

            onSnapshot(q, (querySnapshot) => {
                feedLoader.classList.add('hidden');
                poemFeed.innerHTML = '';
                
                const poems = [];
                querySnapshot.forEach((doc) => poems.push({ id: doc.id, ...doc.data() }));
                
                poems.sort((a, b) => b.createdAt.toDate() - a.createdAt.toDate());

                if (poems.length === 0) {
                    poemFeed.innerHTML = '<p class="text-center text-white/80">এখনও কোন সৃষ্টি শেয়ার করা হয়নি। আপনি প্রথম হন!</p>';
                } else {
                    poems.forEach(poemData => poemFeed.appendChild(createPoemElement(poemData)));
                }
            }, (error) => {
                console.error("Error listening to poems collection: ", error);
                poemFeed.innerHTML = `<p class="text-red-500 text-center">Error: Could not fetch poems.</p>`;
            });
        }

        function createPoemElement(poemData) {
            const div = document.createElement('div');
            div.className = 'card p-6 animate-fade-in';
            
            const formattedDate = poemData.createdAt.toDate().toLocaleDateString('bn-BD', {
                year: 'numeric', month: 'long', day: 'numeric'
            });

            // Escape quotes for data attributes
            const escapeAttr = (str) => str.replace(/"/g, "&quot;");

            div.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-start">
                    <div class="md:col-span-1">
                        <img src="${poemData.imageUrl}" alt="Poem image for ${poemData.title}" class="w-full h-auto object-cover rounded-lg shadow-lg border-2 border-white/50">
                    </div>
                    <div class="md:col-span-2">
                        <h3 class="font-title text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-gray-800 to-gray-600">${poemData.title}</h3>
                        <p class="text-sm text-gray-600 mb-4">লিখেছেন <span class="font-semibold text-pink-700">${poemData.author}</span> ${formattedDate} তারিখে</p>
                        <p class="text-gray-800 whitespace-pre-wrap">${poemData.poem}</p>
                        <div class="mt-4">
                            <a href="#" class="share-btn inline-flex items-center px-3 py-1 bg-blue-600 text-white text-xs font-bold rounded-full hover:bg-blue-700 transition"
                               data-title="${escapeAttr(poemData.title)}"
                               data-author="${escapeAttr(poemData.author)}"
                               data-poem="${escapeAttr(poemData.poem)}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v2.385z"/></svg>
                                শেয়ার করুন
                            </a>
                        </div>
                    </div>
                </div>
            `;
            return div;
        }

        // Initialize the app
        main();
    </script>
</body>
</html>
